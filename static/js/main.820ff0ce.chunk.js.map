{"version":3,"sources":["App.js","index.js"],"names":["App","useState","isPendingTransaction","setIsPendingTransaction","currentAccount","setCurrentAccount","allTrees","setAllTrees","message","setMessage","contractAddress","contractABI","abi","checkIfWalletIsConnected","a","window","ethereum","console","log","request","method","accounts","length","account","connectWallet","alert","getAllTrees","plant","provider","ethers","providers","Web3Provider","signer","getSigner","treePortalContract","Contract","getTotalTrees","count","toNumber","gasLimit","plantTxn","hash","wait","trees","treesCleaned","forEach","tree","push","address","planter","timestamp","Date","useEffect","onNewTree","from","prevState","on","off","className","href","type","placeholder","defaultValue","onChange","event","target","value","disabled","onClick","map","index","key","open","toString","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.820ff0ce.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { ethers } from \"ethers\";\nimport './App.css';\nimport abi from \"./utils/TreePortal.json\";\n\n\nconst App = () => {\n  const [isPendingTransaction, setIsPendingTransaction] = useState(false);\n  const [currentAccount, setCurrentAccount] = useState(\"\");\n  const [allTrees, setAllTrees] = useState([]);\n  const [message, setMessage] = useState(\"\");\n  const contractAddress = \"0x9a7A04F79c402e29cf946E828c6d0098Ca5247d7\";\n  const contractABI = abi.abi;\n\n  const checkIfWalletIsConnected = async () => {\n    try {\n      const { ethereum } = window;\n\n      if (!ethereum) {\n        console.log(\"Make sure you have MetaMask\");\n        return;\n      }\n\n      const accounts = await ethereum.request({ method: 'eth_accounts' });\n\n      if (accounts.length !== 0) {\n        const account = accounts[0];\n        console.log(\"Found an authorized account:\", account);\n        setCurrentAccount(account);\n      } else {\n        console.log(\"No authorized account found\");\n      }\n    } catch(err) {\n      console.log(err);\n    }\n  }\n\n  const connectWallet = async () => {\n    try {\n      const { ethereum } = window;\n\n      if (!ethereum) {\n        alert(\"Get MetaMask\");\n        return;\n      }\n\n      const accounts = await ethereum.request({ method: \"eth_requestAccounts\"});\n\n      console.log(\"Connected\", accounts[0]);\n      setCurrentAccount(accounts[0]);\n      getAllTrees();\n    } catch(err) {\n      console.log(err);\n    }\n  }\n\n  const plant = async (message) => {\n    setIsPendingTransaction(true);\n    try {\n      const { ethereum } = window;\n\n      if (ethereum) {\n        const provider = new ethers.providers.Web3Provider(ethereum);\n        const signer = provider.getSigner();\n        const treePortalContract = new ethers.Contract(contractAddress, contractABI, signer);\n\n        let count = await treePortalContract.getTotalTrees();\n        console.log(\"Retrieved total tree count...\", count.toNumber());\n        const plantTxn = await treePortalContract.plant(message, { gasLimit: 300000 });\n        console.log(\"Mining...\", plantTxn.hash);\n\n        await plantTxn.wait();\n        console.log(\"Mined -- \", plantTxn.hash);\n\n        // count = await treePortalContract.getTotalTrees();\n        // console.log(\"Retrieved total tree count...\", count.toNumber());\n        setMessage(\"\");\n      } else {\n        console.log(\"Ethereum object doesn't exist\");\n      }\n    } catch(err) {\n      console.log(err);\n      alert(\"Transaction failed\")\n    }\n    setIsPendingTransaction(false)\n  }\n\n  const getAllTrees = async () => {\n    try {\n      const { ethereum } = window;\n\n      if (ethereum) {\n        const provider = new ethers.providers.Web3Provider(ethereum);\n        const signer = provider.getSigner();\n        const treePortalContract = new ethers.Contract(contractAddress, contractABI, signer);\n\n        const trees = await treePortalContract.getAllTrees();\n\n        let treesCleaned = [];\n        trees.forEach(tree => {\n          treesCleaned.push({\n            address: tree.planter,\n            timestamp: new Date(tree.timestamp * 1000),\n            message: tree.message\n          });\n        });\n\n        setAllTrees(treesCleaned);\n      } else {\n        console.log(\"Ethereum object doesn't exist\");\n      }\n    } catch(err) {\n      console.log(err);\n    }\n  }\n\n  useEffect(() => {\n    let treePortalContract;\n\n    const onNewTree = (from, timestamp, message) => {\n      console.log('NewTree', from, timestamp, message);\n      setAllTrees(prevState => [\n        ...prevState,\n        {\n          address: from,\n          timestamp: new Date(timestamp * 1000),\n          message: message,\n        }\n      ])\n    }\n\n    if (window.ethereum) {\n      const provider = new ethers.providers.Web3Provider(window.ethereum);\n      const signer = provider.getSigner();\n\n      treePortalContract = new ethers.Contract(contractAddress, contractABI, signer);\n      console.log(treePortalContract)\n      treePortalContract.on('NewTree', onNewTree);\n    }\n\n    return () => {\n      if (treePortalContract) {\n        treePortalContract.off('NewTree', onNewTree);\n      }\n    }\n  }, []);\n\n  const countTrees = async () => {\n    try {\n      const { ethereum } = window;\n\n      if (ethereum) {\n        const provider = new ethers.providers.Web3Provider(ethereum);\n        const signer = provider.getSigner();\n        const treePortalContract = new ethers.Contract(contractAddress, contractABI, signer);\n\n        let count = await treePortalContract.getTotalTrees();\n        console.log(\"Retrieved total tree count...\", count.toNumber());\n      } else {\n        console.log(\"Ethereum object doesn't exist\");\n      }\n    } catch(err) {\n      console.log(err);\n    }\n  }\n\n  const viewAddress = (address) => {\n    window.open(\"https://rinkeby.etherscan.io/address/\"+address);\n  }\n\n  useEffect(() => {\n    checkIfWalletIsConnected();\n    getAllTrees();\n  }, [])\n\n  return (\n    <div className=\"mainContainer\">\n      <div className=\"dataContainer\">\n        <div className=\"header\">\n        Rinkeby Forest\n        </div>\n\n        <div className=\"bio\">\n          Help me build a virtual forest. Connect your wallet on the Rinkeby testnet and send a message when planting your tree. You may even win some testnet eth!\n          <br/><br/>\n          Built by <a href=\"https://dantemonaldo.com\">Dante</a> using <a href=\"https://buildspace.so\">buildspace</a>.\n        </div>\n\n        {currentAccount && (\n          <div className=\"messageInput\">\n            <input type=\"text\" placeholder=\"say something\" defaultValue={message} onChange={event => setMessage(event.target.value)} disabled={isPendingTransaction} />\n            <button onClick={() => plant(message)} disabled={isPendingTransaction}>\n              Plant a Tree\n            </button>\n            <div className=\"spinnerContainer\">\n              {isPendingTransaction && (\n                <div className=\"spinner\"></div>\n              )}\n            </div>\n          </div>\n        )}\n\n        {!currentAccount && (\n          <div className=\"messageInput\">\n            <button onClick={connectWallet}>\n              Connect Wallet\n            </button>\n          </div>\n        )}\n\n        <div>\n          {allTrees.map((tree, index) => {\n            return (\n              <div className=\"planted tooltip\" key={index}>\n                <button className=\"emoji\" onClick={() => {viewAddress(tree.address)}}>🌲</button>\n                <div className=\"tooltiptext\">\n                  {tree.address}<br/><br/>\n                  {tree.message}<br/><br/>\n                  {tree.timestamp.toString()}\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}